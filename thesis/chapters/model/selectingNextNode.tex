\section{Selecting Next Nodes}
\label{sec:selectingNextNode}

When selecting the next node, an ant's route set is dependent on which type of ant it is. 

If ant $a$ is a ``normal ant'' the next node selection is based on an evaluated edge value, $ev$, for each of the possible edges, $e$, where $e$ are defined as edges connected to the current node and not yet visited in the given route. If no such edge exists, the given tour is terminated, or else %Further the current route is added to the route set of $a$, and a new route is created as long as it does not violate constraint \vref{itm:constraintRouteSetSize}, which states that the number of routes in a route set should not exceed a given limit. 
the value $ev$ is calculated as follows: 

$$ev_e = \frac{d_e}{\sum\limits^{n}_{i=1}d_i} + \frac{p_e}{\sum\limits^{n}_{i=1}p_i} + \alpha + \beta$$

where $d$ is the demand for the edge, $p$ is the pheromone value, and $n$ is the possible edges. $\beta$ is a value sat to 1 if $e$ is the choice of the global best ant so far, or else it is sat to 0, used to favor the global best solution so far. %The favoring of the global best solution is inspired by how the velocity and direction of the particles in PSO is based on the global best solution.
$\alpha$ is a value sat to 1 if the connecting node is not yet visited, else it is sat to 0, used to favor nodes not yet visited by ant $a$ in the current route set.  

$ev_e$ is used to calculate the probability, $prop_e$, for $e$ to be chosen, and is calculated as follows:

$$prob_e = \frac{ev_e}{\sum\limits^{n}_{i=1}ev_i}$$

Each edge is given a range between 0 to 1 based on the calculated probability. Every real number between 0 and 1 is covered by a range exactly once. An edge with a high probability is given a large range, and vice versa. A random decimal number between 0 to 1 is used to determine which edge to choose. The edge that holds the random number in the range is chosen and the connecting node of that edge is chosen as next node. Further the pheromone value of the chosen edge $e_p$ is updated by this formula:

$$e_p \pluseq \frac{p_v}{T_e}$$ 

where $p_v$ is a predefined pheromone constant. As this formula shows, an edge with a shorter travel time is granted more pheromone than an edge with longer travel time. This is inspired by the way \citet{hsiao04} updates pheromones, and designed to favor edges with lower cost, which in this case, is lower travel times. 

If ant $a$ is a ``crazy'', the next node is chosen randomly based on the possible edges connected to the current node, without considering the edge value. The probability that ant, $a$, is declared as ``crazy'' is partly determined by a predefined value, $CA$, achieved by the parameter testing, and partly determined by the inertia weight, $IW$. This probability, $p$, is calculated as follows:
$$p = CA*IW$$
The $IW$ decreases at each iteration, resulting in a smaller probability for $a$ to be declared ``crazy''. The rate in which the inertia weight decreases is dependent on the total of number of iterations, $TI$, and is calculated as follows:
$$IW = IW - \frac{IW}{TI}$$

If ant $a$ is a ``following ant'', $a$ consequently chooses the edges chosen by the ant from the previous iteration it is following.  %The percentage of $FA$ is a predefined parameter, selected after excessive testing.