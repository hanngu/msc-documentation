\section{Evaluation}
\label{sec:algoEvaluation}
After each ant in the SuperSwarm colony has created a complete route set, the ants are evaluated. The route sets are evaluated as a whole, because the connectivity and the paths chosen are dependent of the entire route set. The results of the evaluation determines which routes that are granted extra pheromone and which ants to be followed in the next iteration. If the given iteration has produced an ant with a better global solution than a previous iteration, the global best solution is updated.

\subsection{Removing Ants that did not Fulfill the Constraints}
\label{sec:algoRemoval}
Constraint \vref{itm:criteriaConnectedGraph} specifies that a passenger should be able to travel from every node to every other node within the route set. The first step in the evaluation is therefore to remove ants that have generated route sets which corresponds to a disconnected graph. For an undirected graph $G$ to be classified as connected, there must be a path between every pair of nodes. 

\subsection{Calculating Total Fit}
\label{sec:totfit}
In the next step, a fitness function, $TOTFIT(r)$, for the remaining ants' route sets are calculated. This fitness function is used to compare and evaluate the solutions of the produced route sets. The calculation of $TOTFIT(r)$ for route set $r$ is inspired by \citet{kechagiopoulos14} and is described as the sum of $F_{1}(r)$, $F_{2}(r)$ and $F_{3}(r)$: 

$$ TOTFIT(r) = F_{1}(r) + F_{2}(r) + F_{3}(r)$$

\subsubsection{Calculating $F_{1}(r)$}
\label{sec:f1}
$F_{1}(r)$ is referred to as the total travel time for each trip in the network. The demands presented in Table \vref{tbl:mandlDemand} corresponds to the amount of traveled trips between node $i$ and $j$ each day. For every trip $t$ given the demand, $F_{1}(r)$ is determined by the sum of the difference between the travel time of the shortest path given the route set, $TT_{spr}$, and the shortest possible path in the network, $TT_{spn}$:

$$F_{1}(r) = \sum\limits^{t}_{i=1}TT_{spr_i}-TT_{spn_i}$$

Both $TT_{spr}$ and $TT_{spn}$ are calculated using the built-in Dijkstra algorithm in Neo4j. The theoretical best case for $F_{1}(r)$ should ideally be 0, meaning there is no difference between $TT_{spr}$ and $TT_{spn}$ for any trip. In \citet{mandl79}, the author proposes two different methods for calculating $TT_{spr}$ given a specific route set. In the first method, \textit{Method 1}, the path with the shortest traveling time, not considering any transitions, is chosen. In the second method, \textit{Method 2}, the transitions is considered, and chooses the path with the shortest traveling time, including transfer penalties. To achieve the most accurate and realistic results, by including transitions,  \textit{Method 2} is chosen for selecting the path for trip $t$. This gives us the following equation for calculating $TT_{spr}$ between two nodes: 
\newline
$$TT_{spr} = IVT + (\gamma*NT)$$
\newline
where $IVT$ is the in-vehicle travel time, $\gamma$ is the transfer penalty and $NT$ is the number of transfers. For comparison reasons, $\gamma$ is set to 5 minutes, equivalent to \citet{kechagiopoulos14}, \citet{nikolic14} and \citet{mandl79}. %$TT_{spn}$ assumes unlimited routes and therefore equals the calculated $IVT$, because no transfers are needed. Må omformuleres, skjønner den ikke.  

\subsubsection{Calculating $F_{2}(r)$}
\label{sec:f2}
$F_{2}(r)$ reflects the percentage of passengers traveling from their origin to their destination either directly, making a single transfer, or transferring twice. Calculating $F_{2}$ is done using the following equation: 
\newline
$$F_2(r) = (-\tau*d_0(r)) + (-\phi*d_1(r)) + (-\omega*d_2(r))$$
\newline
where $d_0(r)$ is the percentage of passengers traveling directly, $d_1(r)$ is the percentage of passengers making a single transfer, and $d_2(r)$ is the percentage of passengers transferring twice. $\tau$ is sat to $3$, $\phi$ is sat to $2$ and $\omega$ is sat to $1$, and is done to favor route sets with many direct travelers over route sets with many one transfer travelers and two transfers travelers, and route sets with many one transfer travelers over route sets with many two transfers travelers. $\tau$, $\phi$ and $\omega$ are all negative values because the smaller the values of both $F_{1}(r)$ described in Section \vref{sec:f1} and $F_{3}(r)$ described in Section \vref{sec:f3}, the better the route set. The theoretical best value of $F_{2}(r)$ is -300, denoting 100\% of the passengers traveling directly from their origin to their destination. 

\subsubsection{Calculating $F_{3}(r)$}
\label{sec:f3}
$F_3(r)$ is a score that reflects the percentage of unsatisfied passengers. By unsatisfied passengers we mean passengers traveling from their origin to their destination, where the number of transfers is more than or equal to 3. $F_3(r)$ is calculated using the following formula:
\newline
$$F_3(r) = 100 - d_0(r) - d_1(r) - d_2(r)$$
\newline
where, $d_0(r)$, $d_1(r)$, and $d_2(r)$ are the same values described in Section \vref{sec:f2}, and the number $100$ represent 100\%. The theoretical best value of $F_3(r)$ is 0, which reflects no passenger being unsatisfied. 

%Mulig vi skal fjerne denne, er gjentakelse. Men holde sensor i hånda..
The sum of $F_{1}(r)$, $F_{2}(r)$, and $F_{3}(r)$ results in, as described above, the $TOTFIT(r)$ value of ant $a$, and the lower the value of $TOTFIT(r)$, the better the route set $r$. 

\section{Selecting Ants to be Followed}
\label{sec:selctingAntsToBeFollowed}

After the $TOTFIT(r)$ value of each ant is calculated, the ants are added to a list sorted in descending order, where the ant with the best $TOTFIT(r)$ value is placed in the first position. As initiated in Section \vref{sec:algoGeneratingSuperSwarm}, becomes a percentage of the colony followers, and follows the same path as one of the best ants from the previous iteration. To determine the number of ants to be followed for the next iterations, a value $NAF$, is calculated:

$$NAF = ants_{size} * AF$$
 
where $ants_{size}$ is the number of ants that satisfied the constraints, described in Section \vref{sec:algoRemoval}, and the value of $AF$ is selected after excessive testing. Because the list is sorted with respect to the $TOTFIT(r)$ value, the $NAF$ first ants in the list will be the $NAF$ best ants, and these are chosen to get a follower in the next iteration. %The number of followers will also be the same amount of ants to be followed, where $FA_1$ will follow $ba_1$, $FA_2$ will follow $ba_2$, and so on.  

\section{Selecting Route Sets to be Granted More Pheromone}
To boost the algorithm's performance, the edges in the ants' best produced route sets are granted more pheromone. To do this, a percentage of the best routes, $BR$, is selected, and a pheromone constant, $p_b$, is added to the edges in these routes. 
%To do this, a pheromone constant, $p_b$, is added to the edges in $m$, and a percentage of the best routes, $BR$, determines the size of $m$. 
The formula for calculating the number of route sets to be granted extra pheromone, $NBRS$, is as follows:

$$NBRS = ants_{size} * BR$$

As mentioned in Section \vref{sec:selctingAntsToBeFollowed}, is the list of ants sorted, which makes $NBRS$'s first route sets, the best produced route sets.
%  Further, the edges in $NBRS$ best route sets are selected and granted extra pheromone.
Further, the formula for updating the pheromone value, $e_p$, of edge $e$, is as follows:

$$e_p \pluseq \tau*(\frac{p_b}{T_e})$$ 

where $T_e$ is the travel time of edge $e$, and $\tau$ is the number of route sets the edge appeared in. As mentioned in Section \vref{sec:selectingNextNode}, is the pheromone value divided on the travel time to benefit edges with smaller travel time. 